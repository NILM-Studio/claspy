# Wavelet ClaSP Segmentation

本项目主要包含用于时间序列分析和分割的脚本，特别是针对非侵入式负荷监测（NILM）场景中的功率信号处理。核心脚本是 `wavelet_separation.py`。

## 核心功能：wavelet_separation.py

该脚本结合了 **小波变换（Wavelet Transform）** 和 **ClaSPSegmentation** 算法，通过将信号分解为不同频段来提高变点检测（Change Point Detection）的准确性。

### 主要特性：
1.  **异常值去除**：使用中值滤波器（Median Filter）自动识别并剔除信号中的孤立毛刺，同时保留重要的阶跃边缘。
2.  **多分辨率分解**：利用小波变换（默认使用 `db4`）将原始信号分解为低频（近似部分）和高频（细节部分）组件。
3.  **分频段分割**：
    *   对低频分量进行分割，捕捉信号的整体趋势变化（如电器的开关状态）。
    *   对高频分量进行分割，捕捉信号的瞬态突变。
4.  **变点合成**：将不同频段检测到的变点进行映射和均值合成，生成最终的综合变点。
5.  **多小波对比**：自动测试多种小波（`db1` 到 `db4`），并根据检测到的变点数量和质量进行排序，选择最优结果。
6.  **可视化支持**：
    *   生成包含原始信号、清洗信号、高低频组件及变点对比的 4 面板分析图。
    *   生成低频信号的小波变换热图（Scalogram），直观展示能量分布。
7.  **数据导出**：自动将处理后的信号（`data/`）和检测到的变点（`label/`）导出为 CSV 格式，方便后续分析。

## 依赖项

在使用前，请确保已安装以下 Python 库：

```bash
pip install numpy pandas PyWavelets matplotlib scipy claspy
```

## 使用说明

1.  **配置路径**：在 `wavelet_separation.py` 的 `if __name__ == "__main__":` 部分修改 `input_source`（输入 CSV 路径或目录）和 `output_directory`（结果保存目录）。
2.  **运行脚本**：
    ```bash
    python wavelet_separation.py
    ```
3.  **主要参数**：
    *   `apply_diff`: 是否对信号应用差分处理。
    *   `is_plot`: 是否生成可视化图表。
    *   `n`: 为每个文件生成的前 n 个最优小波结果的图表数量。

## 目录结构说明

运行后，输出目录将包含：
-   `data/`: 包含处理后的信号数据（原始、清洗后、高频、低频）。
-   `label/`: 包含合成的变点索引及类型。
-   `*.png`: 详细的分析图表和小波热图。

---

## 辅助脚本

-   **median_wavelet.py**: 一个轻量级的演示脚本，展示了如何使用中值滤波去除时间序列中的孤立毛刺并保留阶跃信号。
